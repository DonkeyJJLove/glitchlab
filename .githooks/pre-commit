#!/usr/bin/env bash
set -euo pipefail

ROOT="$(git rev-parse --show-toplevel)"
cd "$ROOT"

# Python chooser
if command -v py >/dev/null 2>&1; then PY=(py -3); elif command -v python3 >/dev/null 2>&1; then PY=(python3); else PY=(python); fi

# 1) Walidacja .env (Tw√≥j pythonowy hook)
if [[ -f ".githooks/pre-commit.py" ]]; then
  "${PY[@]}" .githooks/pre-commit.py
elif [[ -f "scripts/pre_commit.py" ]]; then
  "${PY[@]}" scripts/pre_commit.py
fi

# 2) pre-diff analiza AST/Mosaic (staged)
if [[ -f "scripts/pre_diff.py" ]]; then
  "${PY[@]}" scripts/pre_diff.py
fi

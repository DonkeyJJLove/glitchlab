#!/usr/bin/env bash
# GLX pre-push (wrapper) â€” uruchamia Pythona 3.9+ z .githooks/pre-push.py
set -euo pipefail

HOOK_DIR="$(cd "$(dirname "$0")" && pwd)"

# ðŸ§© Awaryjna Å›cieÅ¼ka do Twojej instalacji Pythona (format zgodny z Git Bash)
PY_FALLBACK="/c/Python39/python.exe"

# ðŸ§  Interpreter â€” uÅ¼yj zmiennej Å›rodowiskowej $PYTHON lub python3
PY="${PYTHON:-python3}"

# ðŸ” SprawdÅº dostÄ™pnoÅ›Ä‡ interpretera
if ! command -v "$PY" >/dev/null 2>&1; then
  if [ -x "$PY_FALLBACK" ]; then
    echo "[pre-push] python3 not found, using fallback: $PY_FALLBACK" >&2
    PY="$PY_FALLBACK"
  elif command -v python >/dev/null 2>&1; then
    echo "[pre-push] python3 not found, using 'python'." >&2
    PY="python"
  else
    echo "[pre-push] Python not found. Set \$PYTHON or install Python 3.9+." >&2
    exit 127
  fi
fi

# ðŸ§® SprawdÅº wersjÄ™ Pythona
"$PY" - <<'PYVER'
import sys
maj, min = sys.version_info[:2]
if (maj, min) < (3, 9):
    print(f"[pre-push] Python >= 3.9 required (found {maj}.{min}).", file=sys.stderr)
    sys.exit(2)
PYVER

# ðŸš€ Uruchom hooka Pythona, przekazujÄ…c STDIN z Gita dalej
exec "$PY" "$HOOK_DIR/pre-push.py" "$@"

#!/usr/bin/env bash
# GLX post-commit (wrapper) â€” uruchamia Pythona 3.9+ z .githooks/post-commit.py
set -euo pipefail

HOOK_DIR="$(cd "$(dirname "$0")" && pwd)"

# ğŸ§© Awaryjna Å›cieÅ¼ka do Pythona (Twoja instalacja)
# uÅ¼yj formatu zgodnego z Git Bash: /c/Python39/python.exe
PY_FALLBACK="/c/Python39/python.exe"

# ğŸ§  GÅ‚Ã³wny interpreter (zmienna Å›rodowiskowa lub python3)
PY="${PYTHON:-python3}"

# ğŸ” SprawdÅº dostÄ™pnoÅ›Ä‡ interpretera
if ! command -v "$PY" >/dev/null 2>&1; then
  if [ -x "$PY_FALLBACK" ]; then
    echo "[post-commit] python3 not found, using fallback: $PY_FALLBACK" >&2
    PY="$PY_FALLBACK"
  elif command -v python >/dev/null 2>&1; then
    echo "[post-commit] python3 not found, using 'python'." >&2
    PY="python"
  else
    echo "[post-commit] Python not found. Set \$PYTHON or install Python 3.9+." >&2
    exit 127
  fi
fi

# ğŸ§® SprawdÅº wersjÄ™ interpretera
"$PY" - <<'PYVER'
import sys
maj, min = sys.version_info[:2]
if (maj, min) < (3, 9):
    print(f"[post-commit] Python >= 3.9 required (found {maj}.{min}).", file=sys.stderr)
    sys.exit(2)
PYVER

# ğŸš€ Uruchom skrypt hooka
exec "$PY" "$HOOK_DIR/post-commit.py" "$@"
